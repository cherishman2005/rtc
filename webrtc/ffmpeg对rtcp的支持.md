# ffmpeg对rtcp的支持

## FFmpeg 对 RTCP 的支持主要体现在以下几个方面：

### 协议关联与运用

与 RTP 协同工作：RTP 负责实时传输音视频数据，而 RTCP 则为 RTP 提供控制服务。FFmpeg 能够很好地整合二者，在进行流媒体数据传输时，利用 RTCP 的反馈信息来优化 RTP 的传输性能。例如，在网络状况不佳导致丢包时，RTCP 会将丢包信息反馈给发送端，FFmpeg 则可据此调整 RTP 的传输策略，如降低码率等，以保障流媒体播放的流畅性.
支持多种流媒体协议：FFmpeg 支持众多与 RTCP 相关的流媒体协议，像 RTSP、RTP 等。使用 RTSP 协议取流时，FFmpeg 会同时借助 RTCP 以及 RTP 协议来完成功能 ，其中 RTCP 负责对 RTP 进行统计，并实时反馈给发送者，让发送者了解会话状态.

### 功能实现

* 拥塞控制与质量反馈：RTCP 的一个重要功能是通过反馈分配数据的传送质量来进行拥塞控制、监视网络和诊断网络中的问题。FFmpeg 利用 RTCP 的反馈信息，如已发送的数据包数量、无法传送的数据包数量等，来动态调整数据的发送速率，从而适应网络带宽的变化，优化传输效率，保证数据传输的时延最小.
* 源标识与管理：由于 SSRC（同步源标识）在网络拥塞或与会者程序变化时可能会更新，RTCP 可为 RTP 源提供额外的传送层标志。FFmpeg 借助 RTCP 的这一功能，能够准确地识别和管理不同的 RTP 源，确保数据的正确接收和处理.
* 会话控制信息传送：RTCP 还负责传送会话控制信息，FFmpeg 可以利用这些信息来实现会话的建立、维护和结束等操作，确保流媒体传输的正常进行.

### 接口与操作

* 命令行参数：FFmpeg 提供了一系列命令行参数来支持 RTCP 相关的操作。例如，通过设置特定的参数，可以指定 RTCP 反馈信息的发送间隔、控制 RTCP 包的大小等，从而满足不同的应用需求.
* 库函数调用：在编程时，开发者可以使用 FFmpeg 的库函数来更灵活地控制和处理 RTCP 数据。例如，通过调用相关函数，可以获取 RTCP 的统计信息、发送自定义的 RTCP 控制报文等，实现更精细化的流媒体控制.

### 源码修改与扩展

对于一些特殊需求，如在 RTSP 取流时主动发送 RTCP FIR 反馈报文，虽然 FFmpeg 原生接口中不支持操作内部的 RTCP 句柄，但开发者可以通过修改源码来实现。如在 FFmpeg 5.0.1 版本中，可对 avformat.h、rtspdec.c、rtpdec.h、rtpdec.c 等文件进行修改，以增加相应的功能。

