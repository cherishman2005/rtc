<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <style>
    text { font-family: Arial, sans-serif; }
    .title { font-size: 20px; font-weight: bold; }
    .subtitle { font-size: 14px; }
    .component { font-size: 12px; font-weight: bold; }
    .description { font-size: 10px; }
    .arrow { stroke: #333; stroke-width: 1.5; marker-end: url(#arrowhead); }
    .dashed { stroke-dasharray: 5,3; }
    .client { fill: #E1F5FE; stroke: #0288D1; }
    .server { fill: #E8F5E9; stroke: #388E3C; }
    .room { fill: #FFF9C4; stroke: #FBC02D; }
    .transport { fill: #F3E5F5; stroke: #7B1FA2; }
  </style>
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="title">mediasoup-rust VideoRoom 架构</text>
  <text x="400" y="50" text-anchor="middle" class="subtitle">多人视频会议房间实现</text>
  
  <!-- Server Components -->
  <rect x="450" y="80" width="300" height="470" rx="10" ry="10" class="server" stroke-width="2" fill-opacity="0.7" />
  <text x="600" y="100" text-anchor="middle" class="component">服务器端</text>
  
  <!-- WorkerManager -->
  <rect x="480" y="120" width="240" height="40" rx="5" ry="5" class="server" stroke-width="1.5" />
  <text x="600" y="145" text-anchor="middle" class="component">WorkerManager</text>
  
  <!-- RoomsRegistry -->
  <rect x="480" y="170" width="240" height="60" rx="5" ry="5" class="room" stroke-width="1.5" />
  <text x="600" y="190" text-anchor="middle" class="component">RoomsRegistry</text>
  <text x="600" y="210" text-anchor="middle" class="description">管理多个房间，支持创建和获取房间</text>
  
  <!-- Room -->
  <rect x="480" y="240" width="240" height="80" rx="5" ry="5" class="room" stroke-width="1.5" />
  <text x="600" y="260" text-anchor="middle" class="component">Room</text>
  <text x="600" y="275" text-anchor="middle" class="description">房间实例，包含Router和参与者列表</text>
  <text x="600" y="290" text-anchor="middle" class="description">管理Producer和事件通知</text>
  
  <!-- Router -->
  <rect x="500" y="330" width="200" height="40" rx="5" ry="5" class="server" stroke-width="1.5" />
  <text x="600" y="355" text-anchor="middle" class="component">Router</text>
  
  <!-- ParticipantConnection -->
  <rect x="480" y="380" width="240" height="80" rx="5" ry="5" class="server" stroke-width="1.5" />
  <text x="600" y="400" text-anchor="middle" class="component">ParticipantConnection</text>
  <text x="600" y="415" text-anchor="middle" class="description">处理WebSocket连接和消息</text>
  <text x="600" y="430" text-anchor="middle" class="description">管理Transport、Producer和Consumer</text>
  
  <!-- Transports -->
  <rect x="500" y="470" width="90" height="60" rx="5" ry="5" class="transport" stroke-width="1.5" />
  <text x="545" y="490" text-anchor="middle" class="component">Producer</text>
  <text x="545" y="505" text-anchor="middle" class="description">Transport</text>
  
  <rect x="600" y="470" width="90" height="60" rx="5" ry="5" class="transport" stroke-width="1.5" />
  <text x="645" y="490" text-anchor="middle" class="component">Consumer</text>
  <text x="645" y="505" text-anchor="middle" class="description">Transport</text>
  
  <!-- Client Components -->
  <rect x="50" y="80" width="300" height="470" rx="10" ry="10" class="client" stroke-width="2" fill-opacity="0.7" />
  <text x="200" y="100" text-anchor="middle" class="component">客户端</text>
  
  <!-- Client Components Details -->
  <rect x="80" y="120" width="240" height="40" rx="5" ry="5" class="client" stroke-width="1.5" />
  <text x="200" y="145" text-anchor="middle" class="component">WebSocket 连接</text>
  
  <rect x="80" y="170" width="240" height="40" rx="5" ry="5" class="client" stroke-width="1.5" />
  <text x="200" y="195" text-anchor="middle" class="component">本地媒体 (摄像头/麦克风)</text>
  
  <rect x="80" y="220" width="240" height="40" rx="5" ry="5" class="client" stroke-width="1.5" />
  <text x="200" y="245" text-anchor="middle" class="component">远程媒体 (其他参与者)</text>
  
  <rect x="80" y="270" width="110" height="60" rx="5" ry="5" class="transport" stroke-width="1.5" />
  <text x="135" y="290" text-anchor="middle" class="component">发送传输</text>
  <text x="135" y="305" text-anchor="middle" class="description">(Producer)</text>
  
  <rect x="210" y="270" width="110" height="60" rx="5" ry="5" class="transport" stroke-width="1.5" />
  <text x="265" y="290" text-anchor="middle" class="component">接收传输</text>
  <text x="265" y="305" text-anchor="middle" class="description">(Consumer)</text>
  
  <!-- Communication Flow -->
  <text x="400" y="380" text-anchor="middle" class="subtitle">WebSocket 信令</text>
  
  <!-- Arrows -->
  <!-- Room Creation -->
  <line x1="600" y1="230" x2="600" y2="240" class="arrow" />
  
  <!-- Router Creation -->
  <line x1="600" y1="320" x2="600" y2="330" class="arrow" />
  
  <!-- WebSocket Connection -->
  <line x1="320" y1="140" x2="480" y2="140" class="arrow" />
  <line x1="480" y1="140" x2="320" y2="140" class="arrow dashed" />
  
  <!-- Transport Setup -->
  <line x1="190" y1="330" x2="190" y2="380" class="arrow" />
  <line x1="190" y1="380" x2="400" y2="380" class="arrow" />
  <line x1="400" y1="380" x2="480" y2="380" class="arrow" />
  
  <line x1="480" y1="400" x2="400" y2="400" class="arrow dashed" />
  <line x1="400" y1="400" x2="265" y2="400" class="arrow dashed" />
  <line x1="265" y1="400" x2="265" y2="330" class="arrow dashed" />
  
  <!-- Media Flow -->
  <line x1="135" y1="330" x2="135" y2="450" class="arrow" />
  <line x1="135" y1="450" x2="500" y2="500" class="arrow" />
  
  <line x1="600" y1="530" x2="600" y2="550" class="arrow" />
  <line x1="600" y1="550" x2="265" y2="550" class="arrow" />
  <line x1="265" y1="550" x2="265" y2="330" class="arrow" />
  
  <!-- Legend -->
  <rect x="50" y="560" width="15" height="15" class="client" stroke-width="1.5" />
  <text x="70" y="572" class="description">客户端组件</text>
  
  <rect x="150" y="560" width="15" height="15" class="server" stroke-width="1.5" />
  <text x="170" y="572" class="description">服务器组件</text>
  
  <rect x="250" y="560" width="15" height="15" class="room" stroke-width="1.5" />
  <text x="270" y="572" class="description">房间管理</text>
  
  <rect x="350" y="560" width="15" height="15" class="transport" stroke-width="1.5" />
  <text x="370" y="572" class="description">WebRTC传输</text>
  
  <line x1="450" y1="567" x2="480" y2="567" class="arrow" />
  <text x="500" y="572" class="description">数据流向</text>
  
  <line x1="550" y1="567" x2="580" y2="567" class="arrow dashed" />
  <text x="600" y="572" class="description">信令流向</text>
</svg>